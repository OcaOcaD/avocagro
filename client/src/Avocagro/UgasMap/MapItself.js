import React, { useState } from "react";
import {
  Map,
  InfoWindow,
  Marker,
  GoogleApiWrapper,
  Polygon,
} from "google-maps-react";

export const MapContainer = (props) => {
  console.log("map props:", props);

  const polygonCoords = [
    { lat: 19.715039451649513, lng: -103.47234885114328 },
    { lat: 19.70092922238785, lng: -103.46857230104875 },
    { lat: 19.70143426280472, lng: -103.46118013346573 },
    { lat: 19.706625985860867, lng: -103.4610084720995 },
    { lat: 19.709778926816746, lng: -103.455465190628}
  ];

  const uga023_03 = [{"lat":19.783694195080432,"lng":-103.50617691040037},{"lat":19.783371135892406,"lng":-103.50566192626951},{"lat":19.774607905522913,"lng":-103.50669189453123},{"lat":19.77394155723013,"lng":-103.51321502685545},{"lat":19.75839263963196,"lng":-103.52068229675294},{"lat":19.70870027072596,"lng":-103.50325967406783},{"lat":19.70874067205618,"lng":-103.50527669524703},{"lat":19.70049858940456,"lng":-103.50510503387008},{"lat":19.70049858940456,"lng":-103.50304509734664},{"lat":19.698882444978175,"lng":-103.50235845183883},{"lat":19.698882444978175,"lng":-103.5032167587236},{"lat":19.697912750487916,"lng":-103.5032167587236},{"lat":19.697751134168314,"lng":-103.50132848357711},{"lat":19.689023610575422,"lng":-103.49909688567672},{"lat":19.688053856362064,"lng":-103.50664998626266},{"lat":19.680618878961706,"lng":-103.50407506560836},{"lat":19.680618878961706,"lng":-103.50287343596969},{"lat":19.679164169102435,"lng":-103.50132848357711},{"lat":19.67609307157718,"lng":-103.50047017669235},{"lat":19.669789055405417,"lng":-103.50132848357711},{"lat":19.66784930823655,"lng":-103.49823857879196},{"lat":19.6662328343324,"lng":-103.49789525603805},{"lat":19.66461634412937,"lng":-103.49566365813766},{"lat":19.66299983762859,"lng":-103.49635030364547},{"lat":19.65669530657142,"lng":-103.50081349944625},{"lat":19.64602553567498,"lng":-103.51403142547164},{"lat":19.650390527708893,"lng":-103.51471807097946},{"lat":19.648935543556362,"lng":-103.51780797576461},{"lat":19.64748054621146,"lng":-103.52089788054977},{"lat":19.655078720227817,"lng":-103.51523305511031},{"lat":19.658796844461065,"lng":-103.50527669524703},{"lat":19.66380809291618,"lng":-103.5087099227861},{"lat":19.664454694212736,"lng":-103.50407506560836},{"lat":19.66704107332198,"lng":-103.5035600814775},{"lat":19.66817260106149,"lng":-103.50270177459274},{"lat":19.67124385037745,"lng":-103.5006418380693},{"lat":19.67269863214451,"lng":-103.49995519256149},{"lat":19.674153400705826,"lng":-103.50218679046188},{"lat":19.670273988529967,"lng":-103.50476171111617},{"lat":19.66817260106149,"lng":-103.50785161590133},{"lat":19.666071186045613,"lng":-103.50767995452438},{"lat":19.664131393890436,"lng":-103.5112848434404},{"lat":19.667849308236644,"lng":-103.51300145720992},{"lat":19.664293044133085,"lng":-103.51952458953414},{"lat":19.667364367776845,"lng":-103.52141286468063},{"lat":19.664939643473918,"lng":-103.5226144943193},{"lat":19.66574788898291,"lng":-103.52312947845016},{"lat":19.665101292901685,"lng":-103.52364446258102},{"lat":19.669142475624003,"lng":-103.52639104461227},{"lat":19.671405493448145,"lng":-103.52278615569625},{"lat":19.672375348448607,"lng":-103.5226144943193},{"lat":19.673830119944622,"lng":-103.5196962509111},{"lat":19.67528487823425,"lng":-103.520039573665},{"lat":19.679164169102545,"lng":-103.51506139373336},{"lat":19.67835599125071,"lng":-103.52381612395797},{"lat":19.680780512575218,"lng":-103.52450276946578},{"lat":19.678840898451078,"lng":-103.52913762664352},{"lat":19.67560815606067,"lng":-103.53497411345992},{"lat":19.68158867819576,"lng":-103.53995229339156},{"lat":19.689185235706802,"lng":-103.53239919280563},{"lat":19.691932837974928,"lng":-103.53463079070602},{"lat":19.691932837974928,"lng":-103.54184056853805},{"lat":19.68886198528122,"lng":-103.54767705535446},{"lat":19.685467816414572,"lng":-103.54578878020797},{"lat":19.684013150592445,"lng":-103.54990865325485},{"lat":19.68207357561097,"lng":-103.55523015594038},{"lat":19.67657798562653,"lng":-103.56930638885053},{"lat":19.66914247562413,"lng":-103.57153798675093},{"lat":19.665101292901813,"lng":-103.57033635711225},{"lat":19.664293044133213,"lng":-103.57428456878218},{"lat":19.67576979472934,"lng":-103.57737447356733},{"lat":19.68045724518546,"lng":-103.5756578597978},{"lat":19.681103779312785,"lng":-103.57737447356733},{"lat":19.67399176040689,"lng":-103.59402562713178},{"lat":19.679002533858466,"lng":-103.59522725677046},{"lat":19.68110377931281,"lng":-103.5924806747392},{"lat":19.68175031083068,"lng":-103.5917940292314},{"lat":19.68352825904911,"lng":-103.58750249480757},{"lat":19.684336410805944,"lng":-103.58853246306928},{"lat":19.684659670366884,"lng":-103.58990575408491},{"lat":19.685952702085878,"lng":-103.59127904510053},{"lat":19.687730603652742,"lng":-103.5921373519853},{"lat":19.689346860674974,"lng":-103.59368230437788},{"lat":19.688215482472412,"lng":-103.59591390227827},{"lat":19.686922469023884,"lng":-103.59900380706343},{"lat":19.689346860674974,"lng":-103.59711553191694},{"lat":19.691609593096768,"lng":-103.59522725677046},{"lat":19.694357153757515,"lng":-103.59110738372358},{"lat":19.69371067313875,"lng":-103.59831716155561},{"lat":19.69678143282361,"lng":-103.59831716155561},{"lat":19.7003369756967,"lng":-103.59093572234663},{"lat":19.703245997468564,"lng":-103.59282399749311},{"lat":19.7016298807914,"lng":-103.58973409270796},{"lat":19.701145042605127,"lng":-103.58681584929975},{"lat":19.704700488520572,"lng":-103.58801747893843},{"lat":19.708417461128914,"lng":-103.58458425139936},{"lat":19.709225487223215,"lng":-103.58715917205366},{"lat":19.709225487223215,"lng":-103.5921373519853},{"lat":19.71278075354,"lng":-103.59042073821577},{"lat":19.716659135737032,"lng":-103.59145070647749},{"lat":19.716012745237332,"lng":-103.59368230437788},{"lat":19.71391195806522,"lng":-103.59402562713178},{"lat":19.71585114720406,"lng":-103.59608556365522},{"lat":19.71827510055243,"lng":-103.5950555953935},{"lat":19.718436696135566,"lng":-103.58973409270796},{"lat":19.722638123957545,"lng":-103.59024907683882},{"lat":19.724092438626066,"lng":-103.59333898162397},{"lat":19.732010141844842,"lng":-103.59419728850874},{"lat":19.734757008418395,"lng":-103.59145070647749},{"lat":19.72845530322074,"lng":-103.59059239959272},{"lat":19.724900385501094,"lng":-103.59059239959272},{"lat":19.725061974385923,"lng":-103.58836080169233},{"lat":19.728940058599967,"lng":-103.58767415618452},{"lat":19.736372790217892,"lng":-103.589562431331},{"lat":19.74251261195685,"lng":-103.58578588103803},{"lat":19.73879643226513,"lng":-103.58492757415327},{"lat":19.739281156260425,"lng":-103.58046437835249},{"lat":19.73524174467471,"lng":-103.57909108733686},{"lat":19.736049635165784,"lng":-103.57771779632124},{"lat":19.742512611956865,"lng":-103.57874776458296},{"lat":19.74283575392926,"lng":-103.5756578597978},{"lat":19.74428988471068,"lng":-103.57085134124311},{"lat":19.74089689228398,"lng":-103.56947805022749},{"lat":19.742351040725403,"lng":-103.56810475921186},{"lat":19.74849063255896,"lng":-103.57067967986616},{"lat":19.74800593652658,"lng":-103.57239629363569},{"lat":19.751398777839444,"lng":-103.5730829391435},{"lat":19.75430687012018,"lng":-103.57222463225874},{"lat":19.757861133145482,"lng":-103.5753145370439},{"lat":19.763030828898643,"lng":-103.56964971160444},{"lat":19.763838578722435,"lng":-103.56879140471968},{"lat":19.762707727823475,"lng":-103.56707479095014},{"lat":19.761092212628423,"lng":-103.56741811370405},{"lat":19.75883046386298,"lng":-103.56604482268843},{"lat":19.76335392931914,"lng":-103.55986501311811},{"lat":19.76400012819621,"lng":-103.54407216643843},{"lat":19.766100256461144,"lng":-103.53995229339155},{"lat":19.770946600724777,"lng":-103.53943730926069},{"lat":19.776923555722163,"lng":-103.54321385955366},{"lat":19.77983118250291,"lng":-103.54510213470014},{"lat":19.78726154318186,"lng":-103.55162526702436},{"lat":19.79178420170262,"lng":-103.55523015594038},{"lat":19.794530038844297,"lng":-103.55471517180952},{"lat":19.796306731757927,"lng":-103.54939366912397},{"lat":19.7911381154929,"lng":-103.5423555526689},{"lat":19.789038317205716,"lng":-103.534630790706},{"lat":19.785484749334874,"lng":-103.5207262191728},{"lat":19.784354052020866,"lng":-103.51420308684858}]
  const uga023_04 = [{"lat":19.77109440132382,"lng":-103.46875473022459},{"lat":19.77367905562253,"lng":-103.47029968261717},{"lat":19.778040564701797,"lng":-103.47527786254881},{"lat":19.781109703231085,"lng":-103.48420425415037},{"lat":19.78030204092924,"lng":-103.48437591552732},{"lat":19.78353266556833,"lng":-103.50549026489256},{"lat":19.774486751495093,"lng":-103.50652023315428},{"lat":19.77384059512454,"lng":-103.5130433654785},{"lat":19.75849361152006,"lng":-103.52042480468748},{"lat":19.709534949546583,"lng":-103.50325866699217},{"lat":19.711958998645358,"lng":-103.49587722778318},{"lat":19.720038896914136,"lng":-103.49055572509764},{"lat":19.724725050787658,"lng":-103.49639221191404},{"lat":19.725250214642127,"lng":-103.49441810607908},{"lat":19.723513127613657,"lng":-103.4939889526367},{"lat":19.724523064230237,"lng":-103.4888391113281},{"lat":19.726138949540964,"lng":-103.49158569335935},{"lat":19.72516942031533,"lng":-103.48763748168943},{"lat":19.72242238889921,"lng":-103.48780914306639},{"lat":19.71983690443433,"lng":-103.48926826477049},{"lat":19.713534610855934,"lng":-103.4815435028076},{"lat":19.713615411063618,"lng":-103.48068519592283},{"lat":19.718140157526392,"lng":-103.48085685729978},{"lat":19.71947331732735,"lng":-103.48059936523435},{"lat":19.71995809995288,"lng":-103.47656532287596},{"lat":19.719513715935634,"lng":-103.47656532287596},{"lat":19.719513715935634,"lng":-103.47617908477781},{"lat":19.722220399431496,"lng":-103.47574993133543},{"lat":19.722664775923537,"lng":-103.47433372497557},{"lat":19.72432107741756,"lng":-103.47300334930418},{"lat":19.725048228748538,"lng":-103.47167297363279},{"lat":19.727956800983552,"lng":-103.47150131225584},{"lat":19.72868393576957,"lng":-103.47038551330564},{"lat":19.727876008025284,"lng":-103.46635147094725},{"lat":19.727633628905323,"lng":-103.4628324127197},{"lat":19.72957265156948,"lng":-103.46308990478514},{"lat":19.73110769448859,"lng":-103.46472068786619},{"lat":19.734500894914465,"lng":-103.46463485717771},{"lat":19.73571273473991,"lng":-103.45948501586912},{"lat":19.731834814933585,"lng":-103.45485015869139},{"lat":19.731834814933585,"lng":-103.452618560791},{"lat":19.723432332408652,"lng":-103.45279022216795},{"lat":19.723432332408652,"lng":-103.45055862426756},{"lat":19.736197468095458,"lng":-103.44575210571287},{"lat":19.73910583733102,"lng":-103.44128890991209},{"lat":19.74524555397355,"lng":-103.44369216918943},{"lat":19.750900347227404,"lng":-103.44231887817381},{"lat":19.759624492300293,"lng":-103.45382019042967},{"lat":19.766248061553597,"lng":-103.45210357666012}]
  const uga023_18 = [{"lat":19.72468245833118,"lng":-103.49627719797282},{"lat":19.725197523034314,"lng":-103.49445329584269},{"lat":19.72348063423464,"lng":-103.49401341356425},{"lat":19.723440236629017,"lng":-103.4940241424003},{"lat":19.72451076972791,"lng":-103.48875628389506},{"lat":19.72605596051696,"lng":-103.49136339105753},{"lat":19.725147026568205,"lng":-103.48767267145304},{"lat":19.72242019370271,"lng":-103.48784433283},{"lat":19.7198852073469,"lng":-103.48931418337015},{"lat":19.71982965938698,"lng":-103.48931418337015},{"lat":19.71344656527078,"lng":-103.48154650606303},{"lat":19.713527365522967,"lng":-103.48063455499796},{"lat":19.713082963630725,"lng":-103.48185764230875},{"lat":19.712537559620415,"lng":-103.48099933542399},{"lat":19.711365944715755,"lng":-103.48125682748942},{"lat":19.7113457443835,"lng":-103.48243699945597},{"lat":19.71104273909356,"lng":-103.48247991480021},{"lat":19.712355757870274,"lng":-103.48387466348795},{"lat":19.711931552982826,"lng":-103.48391757883219},{"lat":19.70956810515371,"lng":-103.48310218729166},{"lat":19.706598595553803,"lng":-103.48265157617716},{"lat":19.70312399732867,"lng":-103.48282323755411},{"lat":19.687689404986457,"lng":-103.48282323755411},{"lat":19.679850325000785,"lng":-103.48256574548869},{"lat":19.67548613486029,"lng":-103.48393903650431},{"lat":19.6754861348603,"lng":-103.48256574548869},{"lat":19.671121825854065,"lng":-103.48256574548869},{"lat":19.66958620738294,"lng":-103.4850548354545},{"lat":19.669182094813728,"lng":-103.4847115127006},{"lat":19.661584588911495,"lng":-103.49089132227091},{"lat":19.655845808583518,"lng":-103.4968136397758},{"lat":19.647762671166213,"lng":-103.5037659255424},{"lat":19.641134194661277,"lng":-103.50994573511271},{"lat":19.637577338335397,"lng":-103.51389394678263},{"lat":19.634343764212556,"lng":-103.51646886743693},{"lat":19.630786757479243,"lng":-103.51715551294474},{"lat":19.62609785553,"lng":-103.5231636611381},{"lat":19.62957412354344,"lng":-103.52676855005411},{"lat":19.632484429610116,"lng":-103.52591024316935},{"lat":19.63579888062539,"lng":-103.52668271936564},{"lat":19.6395982890961,"lng":-103.52084623254923},{"lat":19.644610137207344,"lng":-103.51346479334025},{"lat":19.645741823189017,"lng":-103.51385103143839},{"lat":19.649298498610133,"lng":-103.50947366632609},{"lat":19.652410524939036,"lng":-103.50569711603312},{"lat":19.655886223247464,"lng":-103.50127683557658},{"lat":19.657947357603348,"lng":-103.49964605249552},{"lat":19.659685156185972,"lng":-103.49835859216837},{"lat":19.664575139519826,"lng":-103.49544034876017},{"lat":19.666272454241405,"lng":-103.4977148620048},{"lat":19.667808104457933,"lng":-103.49797235407023},{"lat":19.669788263285525,"lng":-103.50110517419962},{"lat":19.66984888000663,"lng":-103.50121246256022},{"lat":19.670172168798633,"lng":-103.5011910048881},{"lat":19.672677634826947,"lng":-103.49988208688883},{"lat":19.673303995214063,"lng":-103.5007403937736},{"lat":19.67605186991792,"lng":-103.50033269800333},{"lat":19.679203785814682,"lng":-103.5012982932487},{"lat":19.680678699519802,"lng":-103.50284324564127},{"lat":19.68071910792335,"lng":-103.50398050226359},{"lat":19.688012657779318,"lng":-103.50655542291788},{"lat":19.68900261539771,"lng":-103.49895940698771},{"lat":19.697790746282294,"lng":-103.50127683557658},{"lat":19.697972564585367,"lng":-103.5031007377067},{"lat":19.69882104726854,"lng":-103.50307928003458},{"lat":19.69884124918237,"lng":-103.50224243082194},{"lat":19.700538200838466,"lng":-103.50297199167399},{"lat":19.700578604230003,"lng":-103.50498901285319},{"lat":19.70867927812971,"lng":-103.5052250472465},{"lat":19.70867927812971,"lng":-103.50318656839518},{"lat":19.709416600896766,"lng":-103.50344406046061},{"lat":19.70947720261687,"lng":-103.50317583955912},{"lat":19.711931552983078,"lng":-103.49583731569437},{"lat":19.72003670168536,"lng":-103.49049435533671}]
  // const polygonCoords = [


  //   { lat: 19.785606072893092, lng: -103.48755310027788},
  //   { lat: 19.776398739981325, lng: -103.47442100523097},
  //   { lat: 19.775429516090423, lng: -103.46532295245333},

  // ]
  const inside = (point, vs) => {
    // ray-casting algorithm based on
    // https://wrf.ecse.rpi.edu/Research/Short_Notes/pnpoly.html/pnpoly.html
    var x = point[0],
      y = point[1];
    var inside = false;
    for (var i = 0, j = vs.length - 1; i < vs.length; j = i++) {
      var xi = vs[i][0],
        yi = vs[i][1];
      var xj = vs[j][0],
        yj = vs[j][1];
      var intersect =
        yi > y != yj > y && x < ((xj - xi) * (y - yi)) / (yj - yi) + xi;
      if (intersect) inside = !inside;
    }
    return inside;
  };
  const moveMarker = (coord) => {
    console.log("Marker moving:", coord);
    
    const pol = [];
    const pal = [];
    const pil = [];
    for (const coord of uga023_03) {
      pol.push([coord.lat, coord.lng]);
    }
    for (const coord of uga023_04) {
      pal.push([coord.lat, coord.lng]);
    }
    for (const coord of uga023_18) {
      pil.push([coord.lat, coord.lng]);
    }
    //prepare point to compare inside the polygons
    let p = [coord.latLng.lat(), coord.latLng.lng()];
    // compare if point inside polygon
    // console.log("checking if inside", p, pol);
    let result = inside(p, pol);
    console.log("result 0:", result);
    if(result){
      props.markerDragged(coord, result, 0);
      return
    }
    result = inside(p, pal);
    console.log("result 1:", result);
    if(result){
      props.markerDragged(coord, result, 1);
      return
    }
    result = inside(p, pil);
    console.log("result 2:", result);
    if(result){
      props.markerDragged(coord, result, 2);
      return  
    }

    props.markerDragged(coord, result, 3);
  };

  const onMapClicked = ( thing ) => {
    console.log("thing:", thing)
  }
  //
  return (
    <Map
      google={props.google}
      initialCenter={{
        lat: 19.704525131654737, 
        lng: -103.47699447631834,
      }}
      //
      onMapClick={ onMapClicked}
      //
      // bounds={bounds}
      // onClick={onMapClicked}
      zoom={13}
    >
      <Marker
        title="Location"
        id={1}
        position={props.markerPosition}
        draggable={true}
        onDragend={(t, map, coord) => moveMarker(coord)}
        
      ></Marker>
      <Polygon
        paths={uga023_04}
        strokeColor="#21293A"
        strokeOpacity={0.8}
        strokeWeight={2}
        fillColor="#21293A"
        fillOpacity={0.35}
      />
      <Polygon
        paths={uga023_03}
        strokeColor="#CC2D2D"
        strokeOpacity={0.8}
        strokeWeight={2}
        fillColor="#CC2D2D"
        fillOpacity={0.35}
      />
      <Polygon
        paths={uga023_18}
        strokeColor="#8ACC2D"
        strokeOpacity={0.8}
        strokeWeight={2}
        fillColor="#8ACC2D"
        fillOpacity={0.35}
      />

      
    </Map>
  );
};

export default GoogleApiWrapper({
  apiKey: "AIzaSyC4kmZBsr256XEgb7P2psWTocdOJjcTFlQ",
  libraries: ["geometry"],
})(MapContainer);
